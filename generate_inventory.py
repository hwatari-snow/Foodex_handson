#!/usr/bin/env python3
"""
お惣菜在庫データ生成スクリプト
"""

import csv
import random
from datetime import date

# 商品マスタを読み込み
products = []
with open('/Users/hirokiwatari/repo/Foodex/csv/product_master.csv', 'r', encoding='utf-8') as f:
    reader = csv.DictReader(f)
    for row in reader:
        products.append(row)

# 商品ごとの価格設定
product_prices = {
    '4901001000011': 398, '4901001000028': 498, '4901001000035': 358,
    '4901001000042': 428, '4901001000059': 348, '4901002000018': 498,
    '4901002000025': 598, '4901002000032': 458, '4901002000049': 298,
    '4901002000056': 298, '4901002000063': 248, '4901003000015': 398,
    '4901003000022': 358, '4901003000039': 298, '4901003000046': 458,
    '4901003000053': 498, '4901003000060': 348, '4901003000077': 328,
    '4901004000012': 248, '4901004000029': 228, '4901004000036': 198,
    '4901004000043': 198, '4901004000050': 218, '4901004000067': 258,
    '4901005000019': 198, '4901005000026': 178, '4901005000033': 178,
    '4901005000040': 328, '4901005000057': 298, '4901005000064': 168,
    '4901005000071': 248, '4901006000016': 348, '4901006000023': 498,
    '4901006000030': 428, '4901006000047': 398, '4901006000054': 378,
    '4901006000061': 378, '4901006000078': 298, '4901006000085': 298,
    '4901007000013': 398, '4901007000020': 498, '4901007000037': 498,
    '4901007000044': 548, '4901007000051': 598, '4901007000068': 598,
    '4901007000075': 498, '4901008000010': 138, '4901008000027': 128,
    '4901008000034': 148, '4901008000041': 158, '4901008000058': 128,
    '4901008000065': 178, '4901009000017': 198, '4901009000024': 398,
    '4901009000031': 698, '4901009000048': 598, '4901009000055': 698,
    '4902001000014': 798, '4902001000021': 298, '4902001000038': 298,
    '4902001000045': 498, '4902001000052': 548, '4902001000069': 398,
    '4902001000076': 1280, '4902001000083': 258, '4902001000090': 298,
    '4902001000106': 498, '4902001000113': 298, '4902001000120': 398,
    '4902001000137': 698, '4902001000144': 498, '4902001000151': 398,
    '4902001000168': 2980, '4902001000175': 498, '4902001000182': 298,
    '4903001000011': 398, '4903001000028': 298, '4903001000035': 298,
    '4903001000042': 198, '4903001000059': 298, '4903001000066': 198,
    '4904001000018': 458, '4904001000025': 428, '4904001000032': 498,
    '4904001000049': 548, '4904001000056': 498, '4904001000063': 498,
    '4904001000070': 498, '4905001000015': 498, '4905001000022': 498,
    '4905001000039': 458, '4905001000046': 498, '4905001000053': 548,
    '4905001000060': 548,
}

# 季節商品（2月時点で在庫なし）
seasonal_out_of_stock = [
    '4902001000014',  # 恵方巻き（節分終了）
    '4902001000021',  # 桜餅（まだ早い）
    '4902001000038',  # 柏餅（まだ早い）
    '4902001000045',  # 冷やし中華（まだ早い）
    '4902001000052',  # 冷製パスタ（まだ早い）
    '4902001000069',  # 素麺（まだ早い）
    '4902001000076',  # うなぎ（まだ早い）
    '4902001000083',  # 土用餅（まだ早い）
    '4902001000090',  # おはぎ（まだ早い）
    '4902001000106',  # 栗ご飯（まだ早い）
    '4902001000113',  # 月見団子（まだ早い）
    '4902001000120',  # さんま（まだ早い）
    '4902001000137',  # 松茸ご飯（まだ早い）
    '4902001000151',  # 年越しそば（終了）
    '4902001000168',  # おせち（終了）
    '4902001000175',  # お雑煮（終了）
    '4902001000182',  # 七草粥（終了）
]

snapshot_date = date(2026, 2, 24)
inventory_data = []

for product in products:
    jan = product['JANCODE']
    name = product['PRODUCT_NAME']
    maker = product['MAKER_NAME']
    price = product_prices.get(jan, 398)
    
    if jan in seasonal_out_of_stock:
        # 季節外商品は在庫0
        stock_qty = 0
        status = '季節外'
    else:
        # ランダムに在庫状況を設定
        rand = random.random()
        if rand < 0.05:  # 5%欠品
            stock_qty = 0
            status = '欠品'
        elif rand < 0.15:  # 10%残少
            stock_qty = random.randint(1, 10)
            status = '残少'
        else:  # 通常在庫
            stock_qty = random.randint(20, 150)
            status = '通常'
    
    stock_amount = stock_qty * price
    
    inventory_data.append({
        'SNAPSHOT_DATE': snapshot_date.isoformat(),
        'JANCODE': jan,
        'PRODUCT_NAME': name,
        'MAKER_NAME': maker,
        'STOCK_QTY': stock_qty,
        'UNIT_PRICE': price,
        'STOCK_AMOUNT': stock_amount,
        'STOCK_STATUS': status
    })

# CSVに書き出し
with open('/Users/hirokiwatari/repo/Foodex/csv/inventory_data.csv', 'w', encoding='utf-8', newline='') as f:
    fieldnames = ['SNAPSHOT_DATE', 'JANCODE', 'PRODUCT_NAME', 'MAKER_NAME', 'STOCK_QTY', 'UNIT_PRICE', 'STOCK_AMOUNT', 'STOCK_STATUS']
    writer = csv.DictWriter(f, fieldnames=fieldnames)
    writer.writeheader()
    writer.writerows(inventory_data)

print(f"Generated {len(inventory_data)} inventory records")
